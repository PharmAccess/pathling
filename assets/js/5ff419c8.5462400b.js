"use strict";(self.webpackChunkpathling_site=self.webpackChunkpathling_site||[]).push([[194],{3905:(t,e,n)=>{n.d(e,{Zo:()=>c,kt:()=>g});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),p=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},c=function(t){var e=p(t.components);return a.createElement(s.Provider,{value:e},t.children)},d="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,s=t.parentName,c=i(t,["components","mdxType","originalType","parentName"]),d=p(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||l;return n?a.createElement(g,o(o({ref:e},c),{},{components:n})):a.createElement(g,o({ref:e},c))}));function g(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=t,i[d]="string"==typeof t?t:r,o[1]=i;for(var p=2;p<l;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(t,e,n)=>{n.d(e,{Z:()=>o});var a=n(7294),r=n(6010);const l="tabItem_Ymn6";function o(t){let{children:e,hidden:n,className:o}=t;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,o),hidden:n},e)}},5488:(t,e,n)=>{n.d(e,{Z:()=>m});var a=n(7462),r=n(7294),l=n(6010),o=n(2389),i=n(7392),s=n(7094),p=n(2466);const c="tabList__CuJ",d="tabItem_LNqP";function u(t){const{lazy:e,block:n,defaultValue:o,values:u,groupId:m,className:g}=t,h=r.Children.map(t.children,(t=>{if((0,r.isValidElement)(t)&&"value"in t.props)return t;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof t.type?t.type:t.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=u??h.map((t=>{let{props:{value:e,label:n,attributes:a}}=t;return{value:e,label:n,attributes:a}})),N=(0,i.l)(k,((t,e)=>t.value===e.value));if(N.length>0)throw new Error(`Docusaurus error: Duplicate values "${N.map((t=>t.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===o?o:o??h.find((t=>t.props.default))?.props.value??h[0].props.value;if(null!==y&&!k.some((t=>t.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${k.map((t=>t.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:b}=(0,s.U)(),[f,C]=(0,r.useState)(y),E=[],{blockElementScrollPositionUntilNextRender:T}=(0,p.o5)();if(null!=m){const t=v[m];null!=t&&t!==f&&k.some((e=>e.value===t))&&C(t)}const _=t=>{const e=t.currentTarget,n=E.indexOf(e),a=k[n].value;a!==f&&(T(e),C(a),null!=m&&b(m,String(a)))},S=t=>{let e=null;switch(t.key){case"Enter":_(t);break;case"ArrowRight":{const n=E.indexOf(t.currentTarget)+1;e=E[n]??E[0];break}case"ArrowLeft":{const n=E.indexOf(t.currentTarget)-1;e=E[n]??E[E.length-1];break}}e?.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",c)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},g)},k.map((t=>{let{value:e,label:n,attributes:o}=t;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:f===e?0:-1,"aria-selected":f===e,key:e,ref:t=>E.push(t),onKeyDown:S,onClick:_},o,{className:(0,l.Z)("tabs__item",d,o?.className,{"tabs__item--active":f===e})}),n??e)}))),e?(0,r.cloneElement)(h.filter((t=>t.props.value===f))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((t,e)=>(0,r.cloneElement)(t,{key:e,hidden:t.props.value!==f})))))}function m(t){const e=(0,o.Z)();return r.createElement(u,(0,a.Z)({key:String(e)},t))}},1316:(t,e,n)=>{n.d(e,{_6:()=>o,fB:()=>r,t8:()=>l});var a=n(7294);const r=()=>a.createElement("p",null,"To use the Pathling encoders from Python, install the"," ",a.createElement("a",{href:"https://pypi.org/project/pathling/"},"pathling")," package using"," ",a.createElement("a",{href:"https://pip.pypa.io/"},"pip"),". Note that Java 11 is required, with your"," ",a.createElement("code",null,"JAVA_HOME")," properly set."),l=()=>a.createElement("p",null,"To use the Pathling encoders from Scala, install the ",a.createElement("code",null,"au.csiro.pathling:encoders")," ",a.createElement("a",{href:"https://maven.apache.org/"},"Maven")," package."),o=()=>a.createElement("p",null,"To use the Pathling encoders from Java, install the ",a.createElement("code",null,"au.csiro.pathling:encoders")," ",a.createElement("a",{href:"https://maven.apache.org/"},"Maven")," package.")},5652:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),l=n(5488),o=n(5162);n(1316);const i={sidebar_position:3},s="Terminology functions",p={unversionedId:"libraries/terminology",id:"libraries/terminology",title:"Terminology functions",description:"The library also provides a set of functions for querying a FHIR terminology",source:"@site/docs/libraries/terminology.md",sourceDirName:"libraries",slug:"/libraries/terminology",permalink:"/docs/libraries/terminology",draft:!1,editUrl:"https://github.com/aehrc/pathling/tree/main/site/docs/libraries/terminology.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"libraries",previous:{title:"FHIR encoders",permalink:"/docs/libraries/encoders"},next:{title:"FHIRPath query",permalink:"/docs/libraries/fhirpath-query"}},c={},d=[{value:"Value set membership",id:"value-set-membership",level:3},{value:"Concept translation",id:"concept-translation",level:3},{value:"Subsumption testing",id:"subsumption-testing",level:3},{value:"Retrieving properties",id:"retrieving-properties",level:3},{value:"Retrieving designations",id:"retrieving-designations",level:3},{value:"Authentication",id:"authentication",level:3}],u={toc:d};function m(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"terminology-functions"},"Terminology functions"),(0,r.kt)("p",null,"The library also provides a set of functions for querying a FHIR terminology\nserver from within your queries and transformations."),(0,r.kt)("h3",{id:"value-set-membership"},"Value set membership"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"member_of")," function can be used to test the membership of a code within a\n",(0,r.kt)("a",{parentName:"p",href:"https://hl7.org/fhir/valueset.html"},"FHIR value set"),". This can be used with both\nexplicit value sets (i.e. those that have been pre-defined and loaded into the\nterminology server) and implicit value sets (e.g. SNOMED CT\n",(0,r.kt)("a",{parentName:"p",href:"http://snomed.org/ecl"},"Expression Constraint Language"),")."),(0,r.kt)("p",null,'In this example, we take a list of SNOMED CT diagnosis codes and create a new\ncolumn which shows which are viral infections. We use an ECL expression to\ndefine viral infection as a disease with a pathological process of "Infectious\nprocess", and a causative agent of "Virus".'),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pathling import PathlingContext, to_snomed_coding, to_ecl_value_set,\n    member_of\n\npc = PathlingContext.create()\ncsv = pc.spark.read.csv("conditions.csv")\n\nVIRAL_INFECTION_ECL = """\n    << 64572001|Disease| : (\n      << 370135005|Pathological process| = << 441862004|Infectious process|,\n      << 246075003|Causative agent| = << 49872002|Virus|\n    )\n"""\n\ncsv.select(\n    "CODE",\n    "DESCRIPTION",\n    member_of(\n        to_snomed_coding(csv.CODE),\n        to_ecl_value_set(VIRAL_INFECTION_ECL)\n    ).alias("VIRAL_INFECTION"),\n).show()\n'))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.PathlingContext\nimport au.csiro.pathling.sql.Terminology._\nimport au.csiro.pathling.library.TerminologyHelpers._\n\nval pc = PathlingContext.create()\nval csv = pc.getSpark.read.csv("conditions.csv")\n\nval VIRAL_INFECTION_ECL = """\n    << 64572001|Disease| : (\n      << 370135005|Pathological process| = << 441862004|Infectious process|,\n      << 246075003|Causative agent| = << 49872002|Virus|\n    )\n"""\n\ncsv.select(\n    csv.col("CODE"),\n    csv.col("DESCRIPTION"),\n    member_of(toCoding(csv.col("CODE"), "http://snomed.info/sct"),\n        toEclValueSet(VIRAL_INFECTION_ECL)).alias("VIRAL_INFECTION")\n).show()\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import static au.csiro.pathling.library.TerminologyHelpers.*;\nimport static au.csiro.pathling.sql.Terminology.*;\n\nimport au.csiro.pathling.library.PathlingContext;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\n\nclass MyApp {\n    public static void main(String[] args) {\n        PathlingContext pc = PathlingContext.create();\n        Dataset<Row> csv = pc.getSpark().read().csv("conditions.csv");\n        \n        String VIRAL_INFECTION_ECL = """\n            << 64572001|Disease| : (\n              << 370135005|Pathological process| = << 441862004|Infectious process|,\n              << 246075003|Causative agent| = << 49872002|Virus|\n            )\n        """;\n\n        csv.select(\n                csv.col("CODE"),\n                csv.col("DESCRIPTION"),\n                member_of(toSnomedCoding(csv.col("CODE")),\n                        toEclValueSet(VIRAL_INFECTION_ECL)).alias("VIRAL_INFECTION")\n        ).show();\n    }\n}\n\n')))),(0,r.kt)("p",null,"Results in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"CODE"),(0,r.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"),(0,r.kt)("th",{parentName:"tr",align:null},"VIRAL_INFECTION"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"true")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"true")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat"),(0,r.kt)("td",{parentName:"tr",align:null},"false")))),(0,r.kt)("h3",{id:"concept-translation"},"Concept translation"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"translate")," function can be used to translate codes from one code system to\nanother using maps that are known to the terminology server. In this example, we\ntranslate our SNOMED CT diagnosis codes into ",(0,r.kt)("a",{parentName:"p",href:"https://digital.nhs.uk/services/terminology-and-classifications/read-codes"},"Read CTV3"),". "),(0,r.kt)("p",null,"Please note that the\ntype of the output column is the array of coding structs, as the translation may\nproduce multiple results for each input coding."),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pathling import PathlingContext, to_snomed_coding, translate\nfrom pyspark.sql.functions import explode_outer\n\npc = PathlingContext.create()\ncsv = pc.spark.read.csv("conditions.csv")\n\ntranslate_result = csv.withColumn(\n    "READ_CODES",\n    translate(\n        to_snomed_coding(csv.CODE),\n        concept_map_uri="http://snomed.info/sct/900000000000207008?"\n                        "fhir_cm=900000000000497000",\n    ).code,\n)\ntranslate_result.select(\n    "CODE", "DESCRIPTION", explode_outer("READ_CODES").alias("READ_CODE")\n).show()\n'))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.PathlingContext\nimport au.csiro.pathling.sql.Terminology._\nimport au.csiro.pathling.library.TerminologyHelpers._\nimport org.apache.spark.sql.functions.explode_outer\n\nval pc = PathlingContext.create()\nval csv = spark.read.csv("conditions.csv")\n\nval translate_result = csv.withColumn(\n    "READ_CODES",\n    translate(\n        toCoding(csv.col("CODE"), "https://snomed.info/sct"),\n        "http://snomed.info/sct/900000000000207008?fhir_cm=900000000000497000",\n        false, null\n    ).getField("code")\n)\ntranslate_result.select(\n    csv.col("CODE"), csv.col("DESCRIPTION"), explode_outer(translate_result.col("READ_CODES")).alias("READ_CODE")\n).show()\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import static au.csiro.pathling.sql.Terminology.*;\nimport static au.csiro.pathling.library.TerminologyHelpers.*;\nimport static org.apache.spark.sql.functions.explode_outer;\n\nimport au.csiro.pathling.library.PathlingContext;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\n\nclass MyApp {\n    public static void main(String[] args) {\n        PathlingContext pc = PathlingContext.create();\n        Dataset<Row> csv = pc.getSpark().read().csv("conditions.csv");\n\n        val translate_result = csv.withColumn(\n                "READ_CODES",\n                translate(\n                        toCoding(csv.col("CODE"), "https://snomed.info/sct"),\n                        "http://snomed.info/sct/900000000000207008?fhir_cm=900000000000497000",\n                        false, null\n                ).getField("code")\n        );\n        translate_result.select(\n                csv.col("CODE"), csv.col("DESCRIPTION"), \n                explode_outer(translate_result.col("READ_CODES")).alias("READ_CODE")\n        ).show();\n    }\n}\n\n')))),(0,r.kt)("p",null,"Results in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"CODE"),(0,r.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"),(0,r.kt)("th",{parentName:"tr",align:null},"READ_CODE"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"[","X00ik","]")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"[","S34..","]")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"[","XUjp0","]")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"[","XUjp0","]")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat"),(0,r.kt)("td",{parentName:"tr",align:null},"[","A340.","]")))),(0,r.kt)("h3",{id:"subsumption-testing"},"Subsumption testing"),(0,r.kt)("p",null,'Subsumption test is a fancy way of saying "is this code equal or a subtype of\nthis other code".'),(0,r.kt)("p",null,'For example, a code representing "ankle fracture" is subsumed by another code\nrepresenting "fracture". The "fracture" code is more general, and using it with\nsubsumption can help us find other codes representing different subtypes of\nfracture.'),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"subsumes"),' function allows us to perform subsumption testing on codes within\nour data. The order of the left and right operands can be reversed to query\nwhether a code is "subsumed by" another code.'),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from pathling import PathlingContext, Coding, to_snomed_coding, subsumes\n\npc = PathlingContext.create()\ncsv = pc.spark.read.csv(\"conditions.csv\")\n\n# 232208008 |Ear, nose and throat disorder|\nleft_coding = Coding('http://snomed.info/sct', '232208008')\nright_coding_column = to_snomed_coding(csv.CODE)\n\ncsv.select(\n    'CODE', 'DESCRIPTION',\n    subsumes(left_coding, right_coding_column).alias('SUBSUMES')\n).show()\n"))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.PathlingContext\nimport au.csiro.pathling.sql.Terminology._\nimport au.csiro.pathling.library.TerminologyHelpers._\nimport au.csiro.pathling.fhirpath.encoding.CodingEncoding\n\nval pc = PathlingContext.create()\nval csv = spark.read.csv("conditions.csv")\n\ncsv.select(\n    csv.col("CODE"),\n    // 232208008 |Ear, nose and throat disorder|\n    subsumes(\n        CodingEncoding.toStruct(\n            lit(null),\n            lit(SNOMED_URI),\n            lit(null),\n            lit("232208008"),\n            lit(null),\n            lit(null)\n        ), \n        toSnomedCoding(csv.col("CODE"))\n    ).alias("IS_ENT")\n).show()\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import static au.csiro.pathling.sql.Terminology.*;\nimport static au.csiro.pathling.library.TerminologyHelpers.*;\n\nimport au.csiro.pathling.library.PathlingContext;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\n\nclass MyApp {\n    public static void main(String[] args) {\n        PathlingContext pc = PathlingContext.create();\n        Dataset<Row> csv = pc.getSpark().read().csv("conditions.csv");\n\n        csv.select(\n                csv.col("CODE"),\n                // 232208008 |Ear, nose and throat disorder|\n                subsumes(\n                        CodingEncoding.toStruct(\n                                lit(null),\n                                lit(SNOMED_URI),\n                                lit(null),\n                                lit("232208008"),\n                                lit(null),\n                                lit(null)\n                        ),\n                        toSnomedCoding(csv.col("CODE"))\n                ).alias("IS_ENT")\n        ).show();\n    }\n}\n\n')))),(0,r.kt)("p",null,"Results in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"CODE"),(0,r.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"),(0,r.kt)("th",{parentName:"tr",align:null},"IS_ENT"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"true")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"true")))),(0,r.kt)("h3",{id:"retrieving-properties"},"Retrieving properties"),(0,r.kt)("p",null,"Some terminologies contain additional properties that are associated with codes.\nYou can query these properties using the ",(0,r.kt)("inlineCode",{parentName:"p"},"property_of")," function."),(0,r.kt)("p",null,"There is also a ",(0,r.kt)("inlineCode",{parentName:"p"},"display")," function that can be used to retrieve the preferred\ndisplay term for each code."),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pathling import PathlingContext, to_snomed_coding, property_of, display,\n    PropertyType\n\npc = PathlingContext.create()\ncsv = pc.spark.read.csv("conditions.csv")\n\n# Get the parent codes for each code in the dataset.\nparents = csv.withColumn(\n    "PARENTS",\n    property_of(to_snomed_coding(csv.CODE), "parent", PropertyType.CODE),\n)\n# Split each parent code into a separate row.\nexploded_parents = parents.selectExpr(\n    "CODE", "DESCRIPTION", "explode_outer(PARENTS) AS PARENT"\n)\n# Retrieve the preferred term for each parent code.\nwith_displays = exploded_parents.withColumn(\n    "PARENT_DISPLAY", display(to_snomed_coding(exploded_parents.PARENT))\n)\nwith_displays.show()\n'))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.PathlingContext\nimport au.csiro.pathling.sql.Terminology\nimport au.csiro.pathling.sql.Terminology._\nimport au.csiro.pathling.library.TerminologyHelpers._\nimport au.csiro.pathling.fhirpath.encoding.CodingEncoding\n\nval pc = PathlingContext.create()\nval csv = spark.read.csv("conditions.csv")\n\n// Get the parent codes for each code in the dataset.\nval parents = csv.withColumn(\n    "PARENTS",\n    property_of(toSnomedCoding(csv.col("CODE")), "parent", "code")\n)\n// Split each parent code into a separate row.\nval exploded_parents = parents.selectExpr(\n    "CODE", "DESCRIPTION", "explode_outer(PARENTS) AS PARENT"\n)\n// Retrieve the preferred term for each parent code.\nval with_displays = exploded_parents.withColumn(\n    "PARENT_DISPLAY", Terminology.display(toSnomedCoding(exploded_parents.col("PARENT")))\n)\nwith_displays.show()\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import static au.csiro.pathling.sql.Terminology.*;\nimport static au.csiro.pathling.library.TerminologyHelpers.*;\n\nimport au.csiro.pathling.library.PathlingContext;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\n\nclass MyApp {\n    public static void main(String[] args) {\n        PathlingContext pc = PathlingContext.create();\n        Dataset<Row> csv = pc.getSpark().read().csv("conditions.csv");\n\n        // Get the parent codes for each code in the dataset.\n        Dataset<Row> parents = csv.withColumn(\n                "PARENTS",\n                property_of(toSnomedCoding(csv.col("CODE")), "parent", "code")\n        );\n        // Split each parent code into a separate row.\n        Dataset<Row> exploded_parents = parents.selectExpr(\n                "CODE", "DESCRIPTION", "explode_outer(PARENTS) AS PARENT"\n        );\n        // Retrieve the preferred term for each parent code.\n        Dataset<Row> with_displays = exploded_parents.withColumn(\n                "PARENT_DISPLAY", Terminology.display(toSnomedCoding(exploded_parents.col("PARENT")))\n        );\n        with_displays.show();\n    }\n}\n\n')))),(0,r.kt)("p",null,"Results in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"CODE"),(0,r.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"),(0,r.kt)("th",{parentName:"tr",align:null},"PARENT"),(0,r.kt)("th",{parentName:"tr",align:null},"PARENT_DISPLAY"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"43275000"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"68996008"),(0,r.kt)("td",{parentName:"tr",align:null},"Disorder of middle ear")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"125603006"),(0,r.kt)("td",{parentName:"tr",align:null},"Injury of ankle")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"46866001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of lower limb")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"36971009"),(0,r.kt)("td",{parentName:"tr",align:null},"Sinusitis")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"281794004"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral upper respiratory tract infection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"363166002"),(0,r.kt)("td",{parentName:"tr",align:null},"Infective disorder of head")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"36971009"),(0,r.kt)("td",{parentName:"tr",align:null},"Sinusitis")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"281794004"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral upper respiratory tract infection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis"),(0,r.kt)("td",{parentName:"tr",align:null},"363166002"),(0,r.kt)("td",{parentName:"tr",align:null},"Infective disorder of head")))),(0,r.kt)("h3",{id:"retrieving-designations"},"Retrieving designations"),(0,r.kt)("p",null,"Some terminologies contain additional display terms for codes. These can be used\nfor language translations, synonyms, and more. You can query these terms using the ",(0,r.kt)("inlineCode",{parentName:"p"},"designation")," function."),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pathling import PathlingContext, to_snomed_coding, Coding, designation\n\npc = PathlingContext.create()\ncsv = pc.spark.read.csv("conditions.csv")\n\n# Get the synonyms for each code in the dataset.\nsynonyms = csv.withColumn(\n    "SYNONYMS",\n    designation(to_snomed_coding(csv.CODE), Coding.of_snomed("900000000000013009")),\n)\n# Split each synonyms into a separate row.\nexploded_synonyms = synonyms.selectExpr(\n    "CODE", "DESCRIPTION", "explode_outer(SYNONYMS) AS SYNONYM"\n)\nexploded_synonyms.show()\n'))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.PathlingContext\nimport au.csiro.pathling.sql.Terminology._\nimport au.csiro.pathling.library.TerminologyHelpers._\nimport org.hl7.fhir.r4.model.Coding\n\nval pc = PathlingContext.create()\nval csv = spark.read.csv("conditions.csv")\n\n// Get the synonyms for each code in the dataset.\nval synonyms = csv.withColumn(\n    "SYNONYMS",\n    designation(toSnomedCoding(csv.col("CODE")),\n        new Coding("http://snomed.info/sct", "900000000000013009", null))\n)\n// Split each synonym into a separate row.\nval exploded_synonyms = synonyms.selectExpr(\n    "CODE", "DESCRIPTION", "explode_outer(SYNONYMS) AS SYNONYM"\n)\nexploded_synonyms.show()\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import static au.csiro.pathling.sql.Terminology.*;\nimport static au.csiro.pathling.library.TerminologyHelpers.*;\n\nimport au.csiro.pathling.library.PathlingContext;\nimport org.apache.spark.sql.Dataset;\nimport org.apache.spark.sql.Row;\n\nclass MyApp {\n\n    public static void main(String[] args) {\n        PathlingContext pc = PathlingContext.create();\n        Dataset<Row> csv = pc.getSpark().read().csv("conditions.csv");\n\n        // Get the synonyms for each code in the dataset.\n        Dataset<Row> synonyms = csv.withColumn(\n                "SYNONYMS",\n                designation(toSnomedCoding(csv.col("CODE")),\n                        new Coding("http://snomed.info/sct",\n                                "900000000000013009", null))\n        );\n        // Split each synonym into a separate row.\n        Dataset<Row> exploded_synonyms = synonyms.selectExpr(\n                "CODE", "DESCRIPTION", "explode_outer(SYNONYMS) AS SYNONYM"\n        );\n        exploded_synonyms.show();\n    }\n}\n')))),(0,r.kt)("p",null,"Results in:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"CODE"),(0,r.kt)("th",{parentName:"tr",align:null},"DESCRIPTION"),(0,r.kt)("th",{parentName:"tr",align:null},"SYNONYM"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"65363002"),(0,r.kt)("td",{parentName:"tr",align:null},"Otitis media"),(0,r.kt)("td",{parentName:"tr",align:null},"OM - Otitis media")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"Ankle fracture")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"16114001"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of ankle"),(0,r.kt)("td",{parentName:"tr",align:null},"Fracture of distal end of tibia and fibula")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"NULL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"444814009"),(0,r.kt)("td",{parentName:"tr",align:null},"Viral sinusitis (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"NULL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"Septic sore throat")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"Strep throat")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"Strept throat")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal angina")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"43878008"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal sore throat (disorder)"),(0,r.kt)("td",{parentName:"tr",align:null},"Streptococcal pharyngitis")))),(0,r.kt)("h3",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"Pathling can be configured to connect to a protected terminology server by\nsupplying a set of OAuth2 client credentials and a token endpoint."),(0,r.kt)("p",null,"Here is an example of how to authenticate to\nthe ",(0,r.kt)("a",{parentName:"p",href:"https://ontology.nhs.uk/"},"NHS terminology server"),":"),(0,r.kt)(l.Z,{mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from pathling import PathlingContext\n\npc = PathlingContext.create(\n    terminology_server_url='https://ontology.nhs.uk/production1/fhir',\n    token_endpoint='https://ontology.nhs.uk/authorisation/auth/realms/nhs-digital-terminology/protocol/openid-connect/token',\n    client_id='[client ID]',\n    client_secret='[client secret]'\n)\n"))),(0,r.kt)(o.Z,{value:"scala",label:"Scala",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-scala"},'import au.csiro.pathling.library.{PathlingContext, PathlingContextConfiguration}\n\nval config = PathlingContextConfiguration.builder()\n        .terminologyServerUrl("https://ontology.nhs.uk/production1/fhir")\n        .tokenEndpoint("https://ontology.nhs.uk/authorisation/auth/realms/nhs-digital-terminology/protocol/openid-connect/token")\n        .clientId("[client ID]")\n        .clientSecret("[client secret]")\n        .build()\nval pc = PathlingContext.create(config)\n'))),(0,r.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'import au.csiro.pathling.library.PathlingContext;\nimport au.csiro.pathling.library.PathlingContextConfiguration;\n\nclass MyApp {\n    public static void main(String[] args) {\n        PathlingContextConfiguration config = PathlingContextConfiguration.builder()\n                .terminologyServerUrl("https://ontology.nhs.uk/production1/fhir")\n                .tokenEndpoint("https://ontology.nhs.uk/authorisation/auth/realms/nhs-digital-terminology/protocol/openid-connect/token")\n                .clientId("[client ID]")\n                .clientSecret("[client secret]")\n                .build();\n        PathlingContext pc = PathlingContext.create(config);\n        // ...\n    }\n}\n\n')))))}m.isMDXComponent=!0}}]);